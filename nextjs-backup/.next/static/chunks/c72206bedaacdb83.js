(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32545,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(4012);let s=null;async function d(){if(!s)try{s=await e.A(73378)}catch(e){console.error("Failed to load qrcode library",e)}return s}let l={theme_mode:"system",default_currency:"INR",date_format:"DD/MM/YYYY",number_format:"standard",notifications_enabled:!0,chart_palette:null};function i(){let{user:e,isLoading:s}=(0,r.useAuth)(),[d,i]=(0,t.useState)(l),[c,g]=(0,t.useState)(!0),[x,u]=(0,t.useState)(!1),[b,m]=(0,t.useState)(["#3b82f6","#10b981","#facc15","#f43f5e","#a855f7"]),[y,h]=(0,t.useState)("Profile"),[p,f]=(0,t.useState)(null),[j,k]=(0,t.useState)(null),[w,v]=(0,t.useState)(null),[N,S]=(0,t.useState)(""),[C,P]=(0,t.useState)(!1),[T,Y]=(0,t.useState)({current:"",next:"",confirm:""}),[A,_]=(0,t.useState)(!1),[D,F]=(0,t.useState)(null),R=async()=>{try{let e=await fetch("/api/security/2fa/status");if(e.ok){let a=await e.json();a.success?f(!!a.enabled):f(!1)}}catch(e){console.error("2FA status error",e),f(!1)}};async function U(){if(e){u(!0);try{let e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...d,chart_palette:{categorical:b}})});if(e.ok){let a=await e.json();a.success&&i({...d,...a.settings})}}catch(e){console.error("Save settings error",e)}finally{u(!1)}}}return((0,t.useEffect)(()=>{e&&((async()=>{g(!0);try{let e=await fetch("/api/settings");if(e.ok){let a=await e.json();a.success&&a.settings&&(i({...l,...a.settings}),a.settings.chart_palette?.categorical&&m(a.settings.chart_palette.categorical))}}catch(e){console.error("Fetch settings error",e)}finally{g(!1)}})(),R())},[e]),s||c)?(0,a.jsx)("div",{className:"p-6",children:"Loading settings..."}):e?(0,a.jsxs)("div",{className:"max-w-5xl mx-auto p-6 space-y-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"âš™ï¸ Settings"}),(0,a.jsx)("div",{className:"flex gap-2 border-b border-gray-200 dark:border-gray-700 mb-2",children:["Profile","Preferences","Security"].map(e=>(0,a.jsx)("button",{onClick:()=>h(e),className:`px-4 py-2 text-sm rounded-t-md ${y===e?"bg-white dark:bg-gray-800 border border-b-transparent border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400"}`,children:e},e))}),"Preferences"===y&&(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Preferences"}),(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Theme Mode"}),(0,a.jsxs)("select",{className:"w-full rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-sm",value:d.theme_mode,onChange:e=>i(a=>({...a,theme_mode:e.target.value})),children:[(0,a.jsx)("option",{value:"system",children:"System"}),(0,a.jsx)("option",{value:"light",children:"Light"}),(0,a.jsx)("option",{value:"dark",children:"Dark"})]}),(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Default Currency"}),(0,a.jsx)("input",{type:"text",className:"w-full rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-sm",value:d.default_currency,onChange:e=>i(a=>({...a,default_currency:e.target.value.toUpperCase()}))}),(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Date Format"}),(0,a.jsxs)("select",{className:"w-full rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-sm",value:d.date_format,onChange:e=>i(a=>({...a,date_format:e.target.value})),children:[(0,a.jsx)("option",{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),(0,a.jsx)("option",{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),(0,a.jsx)("option",{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]}),(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Number Format"}),(0,a.jsxs)("select",{className:"w-full rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-sm",value:d.number_format,onChange:e=>i(a=>({...a,number_format:e.target.value})),children:[(0,a.jsx)("option",{value:"standard",children:"Standard"}),(0,a.jsx)("option",{value:"compact",children:"Compact"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{id:"notifications",type:"checkbox",checked:d.notifications_enabled,onChange:e=>i(a=>({...a,notifications_enabled:e.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,a.jsx)("label",{htmlFor:"notifications",className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable Notifications"})]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Chart Palette (RGB)"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Customize categorical colors used in charts. Paste hex or use color pickers."}),(0,a.jsxs)("div",{className:"space-y-2",children:[b.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"color",value:e,onChange:e=>m(a=>a.map((a,r)=>r===t?e.target.value:a)),className:"h-8 w-12 rounded-md"}),(0,a.jsx)("input",{type:"text",value:e,onChange:e=>m(a=>a.map((a,r)=>r===t?e.target.value:a)),className:"flex-1 rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-xs"}),(0,a.jsx)("button",{onClick:()=>m(e=>e.filter((e,a)=>a!==t)),className:"text-xs px-2 py-1 rounded-md bg-red-500 text-white",children:"Remove"})]},t)),(0,a.jsx)("button",{onClick:()=>m(e=>[...e,"#6b7280"]),className:"text-sm px-3 py-2 rounded-md bg-blue-600 text-white",children:"Add Color"})]})]})]}),"Profile"===y&&(0,a.jsx)(n,{}),"Security"===y&&(0,a.jsx)(o,{twoFAEnabled:p,twoFASecret:j,twoFAOtpauth:w,onRefreshStatus:R,setTwoFASecret:k,setTwoFAOtpauth:v,twoFAToken:N,setTwoFAToken:S,securityBusy:C,setSecurityBusy:P,pwd:T,setPwd:Y,pwdBusy:A,setPwdBusy:_,pwdMsg:D,setPwdMsg:F}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{disabled:x,onClick:U,className:"px-4 py-2 rounded-lg bg-green-600 hover:bg-green-700 text-white font-medium disabled:opacity-50",children:x?"Saving...":"Save Settings"})})]}):(0,a.jsx)("div",{className:"p-6",children:"Please log in to manage settings."})}function n(){let{user:e}=(0,r.useAuth)(),[s,d]=(0,t.useState)({name:"",phone:"",bio:"",avatar_url:""}),[l,i]=(0,t.useState)(!0),[n,o]=(0,t.useState)(!1),[c,g]=(0,t.useState)(null),[x,u]=(0,t.useState)(!1);async function b(){o(!0);try{await fetch("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}finally{o(!1)}}async function m(){if(c){u(!0);try{let e=new FormData;e.append("avatar",c);let a=await fetch("/api/profile/avatar",{method:"POST",body:e}),t=await a.json();a.ok&&t.success&&t.url&&(d(e=>({...e,avatar_url:t.url})),g(null))}finally{u(!1)}}}return((0,t.useEffect)(()=>{(async()=>{i(!0);try{let e=await fetch("/api/profile");if(e.ok){let a=await e.json();a.user&&d({name:a.user.name||"",phone:a.user.phone||"",bio:a.user.bio||"",avatar_url:a.user.avatar_url||""})}}finally{i(!1)}})()},[]),l)?(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 text-sm text-gray-600 dark:text-gray-400",children:"Loading profile..."}):(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("img",{src:s.avatar_url||`https://www.gravatar.com/avatar/${(e?.email||"").trim().toLowerCase()}`,alt:"avatar",className:"h-16 w-16 rounded-full object-cover border border-gray-200 dark:border-gray-700",onError:e=>{e.currentTarget.src="https://via.placeholder.com/64?text=ðŸ‘¤"}}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Avatar URL"}),(0,a.jsx)("input",{value:s.avatar_url,onChange:e=>d(a=>({...a,avatar_url:e.target.value})),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm",placeholder:"https://... (PNG/JPG/WebP) or /avatars/.."}),(0,a.jsx)("div",{className:"text-[11px] text-gray-500 dark:text-gray-400 mt-1",children:"Paste an image URL or use the local upload below."})]})]}),(0,a.jsxs)("div",{className:"flex items-end gap-3",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Upload local image"}),(0,a.jsx)("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:e=>g(e.target.files?.[0]||null),className:"block w-full text-sm text-gray-900 dark:text-gray-100 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),(0,a.jsx)("button",{onClick:m,disabled:!c||x,className:"px-3 py-2 text-sm rounded-md bg-green-600 text-white disabled:opacity-50",children:x?"Uploading...":"Upload"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Email"}),(0,a.jsx)("input",{disabled:!0,value:e?.email||"",className:"w-full rounded-md bg-gray-100 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Name"}),(0,a.jsx)("input",{value:s.name,onChange:e=>d(a=>({...a,name:e.target.value})),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Phone"}),(0,a.jsx)("input",{value:s.phone,onChange:e=>d(a=>({...a,phone:e.target.value})),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Bio/Description"}),(0,a.jsx)("textarea",{rows:4,value:s.bio,onChange:e=>d(a=>({...a,bio:e.target.value})),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:b,disabled:n,className:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm disabled:opacity-50",children:n?"Saving...":"Save Profile"})})]})}function o(e){let{twoFAEnabled:r,twoFASecret:s,twoFAOtpauth:l,onRefreshStatus:i,setTwoFASecret:n,setTwoFAOtpauth:o,twoFAToken:g,setTwoFAToken:x,securityBusy:u,setSecurityBusy:b,pwd:m,setPwd:y,pwdBusy:h,setPwdBusy:p,pwdMsg:f,setPwdMsg:j}=e,[k,w]=(0,t.useState)(null);async function v(){b(!0);try{let e=await fetch("/api/security/2fa/setup",{method:"POST"}),a=await e.json();if(a.success){n(a.secret),o(a.otpauth);try{let e=await d();if(e?.toDataURL){let t=await e.toDataURL(a.otpauth,{margin:1,width:200});w(t)}}catch{}}}finally{b(!1)}}async function N(){if(g){b(!0);try{let e=await fetch("/api/security/2fa/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:g})});(await e.json()).success&&(x(""),n(null),o(null),await i())}finally{b(!1)}}}async function S(){b(!0);try{await fetch("/api/security/2fa/disable",{method:"POST"}),n(null),o(null),w(null),await i()}finally{b(!1)}}async function C(){if(j(null),!m.current||!m.next||m.next!==m.confirm)return void j("Please fill all fields and ensure new passwords match.");p(!0);try{let e=await fetch("/api/security/password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:m.current,newPassword:m.next})}),a=await e.json();e.ok&&a.success?(y({current:"",next:"",confirm:""}),j("Password updated successfully.")):j(a.error||"Failed to update password")}finally{p(!1)}}return(0,t.useEffect)(()=>{let e=!0;return(async()=>{try{if(!l){e&&w(null);return}let a=await d();if(a?.toDataURL){let t=await a.toDataURL(l,{margin:1,width:200});e&&w(t)}}catch(e){console.error("QR generation failed",e)}})(),()=>{e=!1}},[l]),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-3",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Twoâ€‘Factor Authentication (TOTP)"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Use an authenticator app (Google Authenticator, Authy). We donâ€™t email codes for TOTPâ€”those are generated in your app."}),null===r?(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading 2FA status..."}):r?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-sm text-green-600",children:"2FA is enabled for your account."}),(0,a.jsx)(c,{}),(0,a.jsx)("button",{onClick:S,disabled:u,className:"px-3 py-2 text-sm rounded-md bg-red-600 text-white disabled:opacity-50",children:u?"Working...":"Disable 2FA"})]}):(0,a.jsx)("div",{className:"space-y-3",children:s?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("ol",{className:"list-decimal pl-4 text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[(0,a.jsx)("li",{children:"Open your authenticator app and add an account."}),(0,a.jsx)("li",{children:"Scan the QR or paste the secret below."}),(0,a.jsx)("li",{children:"Enter the first 6â€‘digit code to enable."})]}),(0,a.jsx)("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Secret (keep private):"}),(0,a.jsx)("div",{className:"p-2 rounded-md bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 font-mono text-xs break-all",children:s}),k?(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("img",{src:k,alt:"2FA QR",className:"h-32 w-32 border border-gray-200 dark:border-gray-700 rounded-md bg-white p-1"}),(0,a.jsx)("div",{className:"text-[11px] text-gray-500 dark:text-gray-400 break-all",children:"Scan this QR in Google Authenticator, Authy, etc. If needed, use the secret above."})]}):l?(0,a.jsxs)("div",{className:"text-[11px] text-gray-500 dark:text-gray-400 break-all",children:["QR is generatingâ€¦ If it doesnâ€™t appear, you can add using this link: ",l]}):null,(0,a.jsxs)("div",{className:"flex items-end gap-2 mt-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Enter 6â€‘digit code"}),(0,a.jsx)("input",{value:g,onChange:e=>x(e.target.value),maxLength:6,className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm tracking-widest"})]}),(0,a.jsx)("button",{onClick:N,disabled:u||6!==g.length,className:"px-3 py-2 text-sm rounded-md bg-green-600 text-white disabled:opacity-50",children:"Verify & Enable"})]})]}):(0,a.jsx)("button",{onClick:v,disabled:u,className:"px-3 py-2 text-sm rounded-md bg-blue-600 text-white disabled:opacity-50",children:u?"Working...":"Set up 2FA"})})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-3",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Change Password"}),f&&(0,a.jsx)("div",{className:"text-xs p-2 rounded-md border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 text-gray-700 dark:text-gray-300",children:f}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Current Password"}),(0,a.jsx)("input",{type:"password",value:m.current,onChange:e=>y({...m,current:e.target.value}),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"New Password"}),(0,a.jsx)("input",{type:"password",value:m.next,onChange:e=>y({...m,next:e.target.value}),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Confirm New Password"}),(0,a.jsx)("input",{type:"password",value:m.confirm,onChange:e=>y({...m,confirm:e.target.value}),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:C,disabled:h,className:"px-3 py-2 text-sm rounded-md bg-blue-600 text-white disabled:opacity-50",children:h?"Updating...":"Update Password"})})]})]})}function c(){let[e,r]=(0,t.useState)(!1),[s,d]=(0,t.useState)(null),[l,i]=(0,t.useState)(null);async function n(){r(!0),i(null);try{let e=await fetch("/api/security/2fa/recovery/generate",{method:"POST"}),a=await e.json();e.ok&&a.success&&Array.isArray(a.codes)?d(a.codes):i(a.error||"Failed to generate codes")}finally{r(!1)}}return(0,a.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3 mt-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Recovery Codes"}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Use when you lose access to your authenticator. Each code can be used once."})]}),(0,a.jsx)("button",{onClick:n,disabled:e,className:"px-3 py-2 text-sm rounded-md bg-indigo-600 text-white disabled:opacity-50",children:e?"Working...":"Generate new"})]}),l&&(0,a.jsx)("div",{className:"mt-2 text-xs text-red-500",children:l}),s&&(0,a.jsxs)("div",{className:"mt-3 p-3 rounded-md bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("div",{className:"text-xs text-amber-600 mb-2",children:"Save these now. They wonâ€™t be shown again."}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2 font-mono text-sm",children:s.map((e,t)=>(0,a.jsx)("div",{className:"px-2 py-1 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700",children:e},t))})]})]})}e.s(["default",()=>i])},73378,e=>{e.v(a=>Promise.all(["static/chunks/0cbbe76af706843a.js"].map(a=>e.l(a))).then(()=>a(73134)))}]);