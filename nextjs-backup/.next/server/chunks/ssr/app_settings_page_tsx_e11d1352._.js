module.exports=[45343,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(93852);let e=null;async function f(){if(!e)try{e=await a.A(48393)}catch(a){console.error("Failed to load qrcode library",a)}return e}let g={theme_mode:"system",default_currency:"INR",date_format:"DD/MM/YYYY",number_format:"standard",notifications_enabled:!0,chart_palette:null};function h(){let{user:a,isLoading:e}=(0,d.useAuth)(),[f,h]=(0,c.useState)(g),[k,l]=(0,c.useState)(!0),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(["#3b82f6","#10b981","#facc15","#f43f5e","#a855f7"]),[q,r]=(0,c.useState)("Profile"),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)({current:"",next:"",confirm:""}),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(null),I=async()=>{try{let a=await fetch("/api/security/2fa/status");if(a.ok){let b=await a.json();b.success?t(!!b.enabled):t(!1)}}catch(a){console.error("2FA status error",a),t(!1)}};async function J(){if(a){n(!0);try{let a=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...f,chart_palette:{categorical:o}})});if(a.ok){let b=await a.json();b.success&&h({...f,...b.settings})}}catch(a){console.error("Save settings error",a)}finally{n(!1)}}}return((0,c.useEffect)(()=>{a&&((async()=>{l(!0);try{let a=await fetch("/api/settings");if(a.ok){let b=await a.json();b.success&&b.settings&&(h({...g,...b.settings}),b.settings.chart_palette?.categorical&&p(b.settings.chart_palette.categorical))}}catch(a){console.error("Fetch settings error",a)}finally{l(!1)}})(),I())},[a]),e||k)?(0,b.jsx)("div",{className:"p-6",children:"Loading settings..."}):a?(0,b.jsxs)("div",{className:"max-w-5xl mx-auto p-6 space-y-8",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"âš™ï¸ Settings"}),(0,b.jsx)("div",{className:"flex gap-2 border-b border-gray-200 dark:border-gray-700 mb-2",children:["Profile","Preferences","Security"].map(a=>(0,b.jsx)("button",{onClick:()=>r(a),className:`px-4 py-2 text-sm rounded-t-md ${q===a?"bg-white dark:bg-gray-800 border border-b-transparent border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400"}`,children:a},a))}),"Preferences"===q&&(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Preferences"}),(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Theme Mode"}),(0,b.jsxs)("select",{className:"w-full rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-sm",value:f.theme_mode,onChange:a=>h(b=>({...b,theme_mode:a.target.value})),children:[(0,b.jsx)("option",{value:"system",children:"System"}),(0,b.jsx)("option",{value:"light",children:"Light"}),(0,b.jsx)("option",{value:"dark",children:"Dark"})]}),(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Default Currency"}),(0,b.jsx)("input",{type:"text",className:"w-full rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-sm",value:f.default_currency,onChange:a=>h(b=>({...b,default_currency:a.target.value.toUpperCase()}))}),(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Date Format"}),(0,b.jsxs)("select",{className:"w-full rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-sm",value:f.date_format,onChange:a=>h(b=>({...b,date_format:a.target.value})),children:[(0,b.jsx)("option",{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),(0,b.jsx)("option",{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),(0,b.jsx)("option",{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]}),(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Number Format"}),(0,b.jsxs)("select",{className:"w-full rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-sm",value:f.number_format,onChange:a=>h(b=>({...b,number_format:a.target.value})),children:[(0,b.jsx)("option",{value:"standard",children:"Standard"}),(0,b.jsx)("option",{value:"compact",children:"Compact"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{id:"notifications",type:"checkbox",checked:f.notifications_enabled,onChange:a=>h(b=>({...b,notifications_enabled:a.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,b.jsx)("label",{htmlFor:"notifications",className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable Notifications"})]})]}),(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Chart Palette (RGB)"}),(0,b.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Customize categorical colors used in charts. Paste hex or use color pickers."}),(0,b.jsxs)("div",{className:"space-y-2",children:[o.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"color",value:a,onChange:a=>p(b=>b.map((b,d)=>d===c?a.target.value:b)),className:"h-8 w-12 rounded-md"}),(0,b.jsx)("input",{type:"text",value:a,onChange:a=>p(b=>b.map((b,d)=>d===c?a.target.value:b)),className:"flex-1 rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-xs"}),(0,b.jsx)("button",{onClick:()=>p(a=>a.filter((a,b)=>b!==c)),className:"text-xs px-2 py-1 rounded-md bg-red-500 text-white",children:"Remove"})]},c)),(0,b.jsx)("button",{onClick:()=>p(a=>[...a,"#6b7280"]),className:"text-sm px-3 py-2 rounded-md bg-blue-600 text-white",children:"Add Color"})]})]})]}),"Profile"===q&&(0,b.jsx)(i,{}),"Security"===q&&(0,b.jsx)(j,{twoFAEnabled:s,twoFASecret:u,twoFAOtpauth:w,onRefreshStatus:I,setTwoFASecret:v,setTwoFAOtpauth:x,twoFAToken:y,setTwoFAToken:z,securityBusy:A,setSecurityBusy:B,pwd:C,setPwd:D,pwdBusy:E,setPwdBusy:F,pwdMsg:G,setPwdMsg:H}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)("button",{disabled:m,onClick:J,className:"px-4 py-2 rounded-lg bg-green-600 hover:bg-green-700 text-white font-medium disabled:opacity-50",children:m?"Saving...":"Save Settings"})})]}):(0,b.jsx)("div",{className:"p-6",children:"Please log in to manage settings."})}function i(){let{user:a}=(0,d.useAuth)(),[e,f]=(0,c.useState)({name:"",phone:"",bio:"",avatar_url:""}),[g,h]=(0,c.useState)(!0),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(!1);async function o(){j(!0);try{await fetch("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}finally{j(!1)}}async function p(){if(k){n(!0);try{let a=new FormData;a.append("avatar",k);let b=await fetch("/api/profile/avatar",{method:"POST",body:a}),c=await b.json();b.ok&&c.success&&c.url&&(f(a=>({...a,avatar_url:c.url})),l(null))}finally{n(!1)}}}return((0,c.useEffect)(()=>{(async()=>{h(!0);try{let a=await fetch("/api/profile");if(a.ok){let b=await a.json();b.user&&f({name:b.user.name||"",phone:b.user.phone||"",bio:b.user.bio||"",avatar_url:b.user.avatar_url||""})}}finally{h(!1)}})()},[]),g)?(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 text-sm text-gray-600 dark:text-gray-400",children:"Loading profile..."}):(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("img",{src:e.avatar_url||`https://www.gravatar.com/avatar/${(a?.email||"").trim().toLowerCase()}`,alt:"avatar",className:"h-16 w-16 rounded-full object-cover border border-gray-200 dark:border-gray-700",onError:a=>{a.currentTarget.src="https://via.placeholder.com/64?text=ðŸ‘¤"}}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Avatar URL"}),(0,b.jsx)("input",{value:e.avatar_url,onChange:a=>f(b=>({...b,avatar_url:a.target.value})),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm",placeholder:"https://... (PNG/JPG/WebP) or /avatars/.."}),(0,b.jsx)("div",{className:"text-[11px] text-gray-500 dark:text-gray-400 mt-1",children:"Paste an image URL or use the local upload below."})]})]}),(0,b.jsxs)("div",{className:"flex items-end gap-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Upload local image"}),(0,b.jsx)("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:a=>l(a.target.files?.[0]||null),className:"block w-full text-sm text-gray-900 dark:text-gray-100 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),(0,b.jsx)("button",{onClick:p,disabled:!k||m,className:"px-3 py-2 text-sm rounded-md bg-green-600 text-white disabled:opacity-50",children:m?"Uploading...":"Upload"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Email"}),(0,b.jsx)("input",{disabled:!0,value:a?.email||"",className:"w-full rounded-md bg-gray-100 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Name"}),(0,b.jsx)("input",{value:e.name,onChange:a=>f(b=>({...b,name:a.target.value})),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Phone"}),(0,b.jsx)("input",{value:e.phone,onChange:a=>f(b=>({...b,phone:a.target.value})),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Bio/Description"}),(0,b.jsx)("textarea",{rows:4,value:e.bio,onChange:a=>f(b=>({...b,bio:a.target.value})),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)("button",{onClick:o,disabled:i,className:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm disabled:opacity-50",children:i?"Saving...":"Save Profile"})})]})}function j(a){let{twoFAEnabled:d,twoFASecret:e,twoFAOtpauth:g,onRefreshStatus:h,setTwoFASecret:i,setTwoFAOtpauth:j,twoFAToken:l,setTwoFAToken:m,securityBusy:n,setSecurityBusy:o,pwd:p,setPwd:q,pwdBusy:r,setPwdBusy:s,pwdMsg:t,setPwdMsg:u}=a,[v,w]=(0,c.useState)(null);async function x(){o(!0);try{let a=await fetch("/api/security/2fa/setup",{method:"POST"}),b=await a.json();if(b.success){i(b.secret),j(b.otpauth);try{let a=await f();if(a?.toDataURL){let c=await a.toDataURL(b.otpauth,{margin:1,width:200});w(c)}}catch{}}}finally{o(!1)}}async function y(){if(l){o(!0);try{let a=await fetch("/api/security/2fa/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:l})});(await a.json()).success&&(m(""),i(null),j(null),await h())}finally{o(!1)}}}async function z(){o(!0);try{await fetch("/api/security/2fa/disable",{method:"POST"}),i(null),j(null),w(null),await h()}finally{o(!1)}}async function A(){if(u(null),!p.current||!p.next||p.next!==p.confirm)return void u("Please fill all fields and ensure new passwords match.");s(!0);try{let a=await fetch("/api/security/password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:p.current,newPassword:p.next})}),b=await a.json();a.ok&&b.success?(q({current:"",next:"",confirm:""}),u("Password updated successfully.")):u(b.error||"Failed to update password")}finally{s(!1)}}return(0,c.useEffect)(()=>{let a=!0;return(async()=>{try{if(!g){a&&w(null);return}let b=await f();if(b?.toDataURL){let c=await b.toDataURL(g,{margin:1,width:200});a&&w(c)}}catch(a){console.error("QR generation failed",a)}})(),()=>{a=!1}},[g]),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-3",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Twoâ€‘Factor Authentication (TOTP)"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Use an authenticator app (Google Authenticator, Authy). We donâ€™t email codes for TOTPâ€”those are generated in your app."}),null===d?(0,b.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading 2FA status..."}):d?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"text-sm text-green-600",children:"2FA is enabled for your account."}),(0,b.jsx)(k,{}),(0,b.jsx)("button",{onClick:z,disabled:n,className:"px-3 py-2 text-sm rounded-md bg-red-600 text-white disabled:opacity-50",children:n?"Working...":"Disable 2FA"})]}):(0,b.jsx)("div",{className:"space-y-3",children:e?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("ol",{className:"list-decimal pl-4 text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[(0,b.jsx)("li",{children:"Open your authenticator app and add an account."}),(0,b.jsx)("li",{children:"Scan the QR or paste the secret below."}),(0,b.jsx)("li",{children:"Enter the first 6â€‘digit code to enable."})]}),(0,b.jsx)("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Secret (keep private):"}),(0,b.jsx)("div",{className:"p-2 rounded-md bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 font-mono text-xs break-all",children:e}),v?(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("img",{src:v,alt:"2FA QR",className:"h-32 w-32 border border-gray-200 dark:border-gray-700 rounded-md bg-white p-1"}),(0,b.jsx)("div",{className:"text-[11px] text-gray-500 dark:text-gray-400 break-all",children:"Scan this QR in Google Authenticator, Authy, etc. If needed, use the secret above."})]}):g?(0,b.jsxs)("div",{className:"text-[11px] text-gray-500 dark:text-gray-400 break-all",children:["QR is generatingâ€¦ If it doesnâ€™t appear, you can add using this link: ",g]}):null,(0,b.jsxs)("div",{className:"flex items-end gap-2 mt-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Enter 6â€‘digit code"}),(0,b.jsx)("input",{value:l,onChange:a=>m(a.target.value),maxLength:6,className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm tracking-widest"})]}),(0,b.jsx)("button",{onClick:y,disabled:n||6!==l.length,className:"px-3 py-2 text-sm rounded-md bg-green-600 text-white disabled:opacity-50",children:"Verify & Enable"})]})]}):(0,b.jsx)("button",{onClick:x,disabled:n,className:"px-3 py-2 text-sm rounded-md bg-blue-600 text-white disabled:opacity-50",children:n?"Working...":"Set up 2FA"})})]}),(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-3",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Change Password"}),t&&(0,b.jsx)("div",{className:"text-xs p-2 rounded-md border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 text-gray-700 dark:text-gray-300",children:t}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Current Password"}),(0,b.jsx)("input",{type:"password",value:p.current,onChange:a=>q({...p,current:a.target.value}),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"New Password"}),(0,b.jsx)("input",{type:"password",value:p.next,onChange:a=>q({...p,next:a.target.value}),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Confirm New Password"}),(0,b.jsx)("input",{type:"password",value:p.confirm,onChange:a=>q({...p,confirm:a.target.value}),className:"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm"})]}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)("button",{onClick:A,disabled:r,className:"px-3 py-2 text-sm rounded-md bg-blue-600 text-white disabled:opacity-50",children:r?"Updating...":"Update Password"})})]})]})}function k(){let[a,d]=(0,c.useState)(!1),[e,f]=(0,c.useState)(null),[g,h]=(0,c.useState)(null);async function i(){d(!0),h(null);try{let a=await fetch("/api/security/2fa/recovery/generate",{method:"POST"}),b=await a.json();a.ok&&b.success&&Array.isArray(b.codes)?f(b.codes):h(b.error||"Failed to generate codes")}finally{d(!1)}}return(0,b.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3 mt-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Recovery Codes"}),(0,b.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Use when you lose access to your authenticator. Each code can be used once."})]}),(0,b.jsx)("button",{onClick:i,disabled:a,className:"px-3 py-2 text-sm rounded-md bg-indigo-600 text-white disabled:opacity-50",children:a?"Working...":"Generate new"})]}),g&&(0,b.jsx)("div",{className:"mt-2 text-xs text-red-500",children:g}),e&&(0,b.jsxs)("div",{className:"mt-3 p-3 rounded-md bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("div",{className:"text-xs text-amber-600 mb-2",children:"Save these now. They wonâ€™t be shown again."}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2 font-mono text-sm",children:e.map((a,c)=>(0,b.jsx)("div",{className:"px-2 py-1 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700",children:a},c))})]})]})}a.s(["default",()=>h])}];

//# sourceMappingURL=app_settings_page_tsx_e11d1352._.js.map