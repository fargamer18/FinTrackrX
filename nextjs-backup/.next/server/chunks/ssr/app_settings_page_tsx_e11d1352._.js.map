{"version":3,"sources":["turbopack:///[project]/app/settings/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useAuth } from '@/components/AuthProvider';\r\n// Dynamic import of qrcode to avoid type issues during build with React 19\r\nlet QRCodeLib: any = null;\r\nasync function ensureQrLib() {\r\n  if (!QRCodeLib) {\r\n    try {\r\n      QRCodeLib = await import('qrcode');\r\n    } catch (e) {\r\n      console.error('Failed to load qrcode library', e);\r\n    }\r\n  }\r\n  return QRCodeLib;\r\n}\r\n\r\ntype SettingsState = {\r\n  theme_mode: 'light' | 'dark' | 'system';\r\n  default_currency: string;\r\n  date_format: string;\r\n  number_format: 'standard' | 'compact';\r\n  notifications_enabled: boolean;\r\n  chart_palette?: {\r\n    categorical?: string[];\r\n    income?: string;\r\n    expense?: string;\r\n  } | null;\r\n};\r\n\r\nconst DEFAULT_SETTINGS: SettingsState = {\r\n  theme_mode: 'system',\r\n  default_currency: 'INR',\r\n  date_format: 'DD/MM/YYYY',\r\n  number_format: 'standard',\r\n  notifications_enabled: true,\r\n  chart_palette: null,\r\n};\r\n\r\nexport default function SettingsPage() {\r\n  const { user, isLoading } = useAuth();\r\n  const [settings, setSettings] = useState<SettingsState>(DEFAULT_SETTINGS);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [paletteDraft, setPaletteDraft] = useState<string[]>(['#3b82f6','#10b981','#facc15','#f43f5e','#a855f7']);\r\n  const [tab, setTab] = useState<'Profile' | 'Preferences' | 'Security'>('Profile');\r\n  // Security state\r\n  const [twoFAEnabled, setTwoFAEnabled] = useState<boolean | null>(null);\r\n  const [twoFASecret, setTwoFASecret] = useState<string | null>(null);\r\n  const [twoFAOtpauth, setTwoFAOtpauth] = useState<string | null>(null);\r\n  const [twoFAToken, setTwoFAToken] = useState('');\r\n  const [securityBusy, setSecurityBusy] = useState(false);\r\n  const [pwd, setPwd] = useState({ current: '', next: '', confirm: '' });\r\n  const [pwdBusy, setPwdBusy] = useState(false);\r\n  const [pwdMsg, setPwdMsg] = useState<string | null>(null);\r\n\r\n  const fetch2FA = async () => {\r\n    try {\r\n      const resp = await fetch('/api/security/2fa/status');\r\n      if (resp.ok) {\r\n        const d = await resp.json();\r\n        if (d.success) {\r\n          setTwoFAEnabled(!!d.enabled);\r\n        } else {\r\n          setTwoFAEnabled(false);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error('2FA status error', e);\r\n      setTwoFAEnabled(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!user) return;\r\n    const fetchSettings = async () => {\r\n      setLoading(true);\r\n      try {\r\n      const resp = await fetch('/api/settings');\r\n        if (resp.ok) {\r\n          const data = await resp.json();\r\n          if (data.success && data.settings) {\r\n            setSettings({ ...DEFAULT_SETTINGS, ...data.settings });\r\n            if (data.settings.chart_palette?.categorical) {\r\n              setPaletteDraft(data.settings.chart_palette.categorical);\r\n            }\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error('Fetch settings error', e);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchSettings();\r\n    fetch2FA();\r\n  }, [user]);\r\n\r\n  async function saveSettings() {\r\n    if (!user) return;\r\n    setSaving(true);\r\n    try {\r\n      const resp = await fetch('/api/settings', {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ ...settings, chart_palette: { categorical: paletteDraft } }),\r\n      });\r\n      if (resp.ok) {\r\n        const data = await resp.json();\r\n        if (data.success) {\r\n          setSettings({ ...settings, ...data.settings });\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error('Save settings error', e);\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  if (isLoading || loading) {\r\n    return <div className=\"p-6\">Loading settings...</div>;\r\n  }\r\n  if (!user) {\r\n    return <div className=\"p-6\">Please log in to manage settings.</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-5xl mx-auto p-6 space-y-8\">\r\n      <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">‚öôÔ∏è Settings</h1>\r\n      {/* Tabs */}\r\n      <div className=\"flex gap-2 border-b border-gray-200 dark:border-gray-700 mb-2\">\r\n        {(['Profile','Preferences','Security'] as const).map(t => (\r\n          <button\r\n            key={t}\r\n            onClick={() => setTab(t)}\r\n            className={`px-4 py-2 text-sm rounded-t-md ${tab===t ? 'bg-white dark:bg-gray-800 border border-b-transparent border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white' : 'text-gray-600 dark:text-gray-400'}`}\r\n          >{t}</button>\r\n        ))}\r\n      </div>\r\n\r\n      {tab === 'Preferences' && (\r\n      <div className=\"grid md:grid-cols-2 gap-8\">\r\n        {/* Preferences */}\r\n        <div className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-4\">\r\n          <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Preferences</h2>\r\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Theme Mode</label>\r\n          <select\r\n            className=\"w-full rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-sm\"\r\n            value={settings.theme_mode}\r\n            onChange={(e) => setSettings(s => ({ ...s, theme_mode: e.target.value as any }))}\r\n          >\r\n            <option value=\"system\">System</option>\r\n            <option value=\"light\">Light</option>\r\n            <option value=\"dark\">Dark</option>\r\n          </select>\r\n\r\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Default Currency</label>\r\n          <input\r\n            type=\"text\"\r\n            className=\"w-full rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-sm\"\r\n            value={settings.default_currency}\r\n            onChange={(e) => setSettings(s => ({ ...s, default_currency: e.target.value.toUpperCase() }))}\r\n          />\r\n\r\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Date Format</label>\r\n            <select\r\n              className=\"w-full rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-sm\"\r\n              value={settings.date_format}\r\n              onChange={(e) => setSettings(s => ({ ...s, date_format: e.target.value }))}\r\n            >\r\n              <option value=\"DD/MM/YYYY\">DD/MM/YYYY</option>\r\n              <option value=\"MM/DD/YYYY\">MM/DD/YYYY</option>\r\n              <option value=\"YYYY-MM-DD\">YYYY-MM-DD</option>\r\n            </select>\r\n\r\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Number Format</label>\r\n          <select\r\n            className=\"w-full rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-sm\"\r\n            value={settings.number_format}\r\n            onChange={(e) => setSettings(s => ({ ...s, number_format: e.target.value as any }))}\r\n          >\r\n            <option value=\"standard\">Standard</option>\r\n            <option value=\"compact\">Compact</option>\r\n          </select>\r\n\r\n          <div className=\"flex items-center gap-2\">\r\n            <input\r\n              id=\"notifications\"\r\n              type=\"checkbox\"\r\n              checked={settings.notifications_enabled}\r\n              onChange={(e) => setSettings(s => ({ ...s, notifications_enabled: e.target.checked }))}\r\n              className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n            />\r\n            <label htmlFor=\"notifications\" className=\"text-sm text-gray-700 dark:text-gray-300\">Enable Notifications</label>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Chart Palette */}\r\n        <div className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-4\">\r\n          <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Chart Palette (RGB)</h2>\r\n          <p className=\"text-xs text-gray-600 dark:text-gray-400\">Customize categorical colors used in charts. Paste hex or use color pickers.</p>\r\n          <div className=\"space-y-2\">\r\n            {paletteDraft.map((c, idx) => (\r\n              <div key={idx} className=\"flex items-center gap-2\">\r\n                <input\r\n                  type=\"color\"\r\n                  value={c}\r\n                  onChange={(e) => setPaletteDraft(p => p.map((v,i) => i===idx ? e.target.value : v))}\r\n                  className=\"h-8 w-12 rounded-md\"\r\n                />\r\n                <input\r\n                  type=\"text\"\r\n                  value={c}\r\n                  onChange={(e) => setPaletteDraft(p => p.map((v,i) => i===idx ? e.target.value : v))}\r\n                  className=\"flex-1 rounded-md bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 p-2 text-xs\"\r\n                />\r\n                <button\r\n                  onClick={() => setPaletteDraft(p => p.filter((_,i) => i!==idx))}\r\n                  className=\"text-xs px-2 py-1 rounded-md bg-red-500 text-white\"\r\n                >Remove</button>\r\n              </div>\r\n            ))}\r\n            <button\r\n              onClick={() => setPaletteDraft(p => [...p, '#6b7280'])}\r\n              className=\"text-sm px-3 py-2 rounded-md bg-blue-600 text-white\"\r\n            >Add Color</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      )}\r\n      {tab === 'Profile' && (\r\n        <ProfileTab />\r\n      )}\r\n      {tab === 'Security' && (\r\n        <SecurityTab\r\n          twoFAEnabled={twoFAEnabled}\r\n          twoFASecret={twoFASecret}\r\n          twoFAOtpauth={twoFAOtpauth}\r\n          onRefreshStatus={fetch2FA}\r\n          setTwoFASecret={setTwoFASecret}\r\n          setTwoFAOtpauth={setTwoFAOtpauth}\r\n          twoFAToken={twoFAToken}\r\n          setTwoFAToken={setTwoFAToken}\r\n          securityBusy={securityBusy}\r\n          setSecurityBusy={setSecurityBusy}\r\n          pwd={pwd}\r\n          setPwd={setPwd}\r\n          pwdBusy={pwdBusy}\r\n          setPwdBusy={setPwdBusy}\r\n          pwdMsg={pwdMsg}\r\n          setPwdMsg={setPwdMsg}\r\n        />\r\n      )}\r\n\r\n      <div className=\"flex justify-end\">\r\n        <button\r\n          disabled={saving}\r\n          onClick={saveSettings}\r\n          className=\"px-4 py-2 rounded-lg bg-green-600 hover:bg-green-700 text-white font-medium disabled:opacity-50\"\r\n        >{saving ? 'Saving...' : 'Save Settings'}</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ProfileTab() {\r\n  const { user } = useAuth();\r\n  const [form, setForm] = useState({ name: '', phone: '', bio: '', avatar_url: '' });\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [file, setFile] = useState<File | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const load = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const r = await fetch('/api/profile');\r\n        if (r.ok) {\r\n          const d = await r.json();\r\n          if (d.user) setForm({ name: d.user.name || '', phone: d.user.phone || '', bio: d.user.bio || '', avatar_url: d.user.avatar_url || '' });\r\n        }\r\n      } finally { setLoading(false); }\r\n    };\r\n    load();\r\n  }, []);\r\n\r\n  async function save() {\r\n    setSaving(true);\r\n    try {\r\n      await fetch('/api/profile', { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(form) });\r\n    } finally { setSaving(false); }\r\n  }\r\n\r\n  async function uploadAvatar() {\r\n    if (!file) return;\r\n    setUploading(true);\r\n    try {\r\n      const fd = new FormData();\r\n      fd.append('avatar', file);\r\n      const r = await fetch('/api/profile/avatar', { method: 'POST', body: fd });\r\n      const d = await r.json();\r\n      if (r.ok && d.success && d.url) {\r\n        setForm(f => ({ ...f, avatar_url: d.url }));\r\n        setFile(null);\r\n      }\r\n    } finally { setUploading(false); }\r\n  }\r\n\r\n  if (loading) return <div className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 text-sm text-gray-600 dark:text-gray-400\">Loading profile...</div>;\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-4\">\r\n      <div className=\"flex flex-col gap-3\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <img src={form.avatar_url || `https://www.gravatar.com/avatar/${(user?.email || '').trim().toLowerCase()}`} alt=\"avatar\" className=\"h-16 w-16 rounded-full object-cover border border-gray-200 dark:border-gray-700\" onError={(e)=>{(e.currentTarget as HTMLImageElement).src='https://via.placeholder.com/64?text=üë§';}} />\r\n          <div className=\"flex-1\">\r\n            <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Avatar URL</label>\r\n            <input value={form.avatar_url} onChange={(e)=>setForm(f=>({...f,avatar_url:e.target.value}))} className=\"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm\" placeholder=\"https://... (PNG/JPG/WebP) or /avatars/..\" />\r\n            <div className=\"text-[11px] text-gray-500 dark:text-gray-400 mt-1\">Paste an image URL or use the local upload below.</div>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-end gap-3\">\r\n          <div className=\"flex-1\">\r\n            <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Upload local image</label>\r\n            <input type=\"file\" accept=\"image/png,image/jpeg,image/jpg,image/webp\" onChange={(e)=>setFile(e.target.files?.[0] || null)} className=\"block w-full text-sm text-gray-900 dark:text-gray-100 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n          </div>\r\n          <button onClick={uploadAvatar} disabled={!file || uploading} className=\"px-3 py-2 text-sm rounded-md bg-green-600 text-white disabled:opacity-50\">{uploading ? 'Uploading...' : 'Upload'}</button>\r\n        </div>\r\n      </div>\r\n      <div>\r\n        <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Email</label>\r\n        <input disabled value={user?.email || ''} className=\"w-full rounded-md bg-gray-100 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 p-2 text-sm\"/>\r\n      </div>\r\n      <div>\r\n        <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Name</label>\r\n        <input value={form.name} onChange={(e)=>setForm(f=>({...f,name:e.target.value}))} className=\"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm\"/>\r\n      </div>\r\n      <div>\r\n        <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Phone</label>\r\n        <input value={form.phone} onChange={(e)=>setForm(f=>({...f,phone:e.target.value}))} className=\"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm\"/>\r\n      </div>\r\n      <div>\r\n        <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Bio/Description</label>\r\n        <textarea rows={4} value={form.bio} onChange={(e)=>setForm(f=>({...f,bio:e.target.value}))} className=\"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm\"/>\r\n      </div>\r\n      <div className=\"flex justify-end\">\r\n        <button onClick={save} disabled={saving} className=\"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm disabled:opacity-50\">{saving ? 'Saving...' : 'Save Profile'}</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SecurityTab(props: {\r\n  twoFAEnabled: boolean | null;\r\n  twoFASecret: string | null;\r\n  twoFAOtpauth: string | null;\r\n  onRefreshStatus: () => void;\r\n  setTwoFASecret: (v: string | null) => void;\r\n  setTwoFAOtpauth: (v: string | null) => void;\r\n  twoFAToken: string;\r\n  setTwoFAToken: (v: string) => void;\r\n  securityBusy: boolean;\r\n  setSecurityBusy: (v: boolean) => void;\r\n  pwd: { current: string; next: string; confirm: string };\r\n  setPwd: (v: { current: string; next: string; confirm: string }) => void;\r\n  pwdBusy: boolean;\r\n  setPwdBusy: (v: boolean) => void;\r\n  pwdMsg: string | null;\r\n  setPwdMsg: (v: string | null) => void;\r\n}) {\r\n  const {\r\n    twoFAEnabled, twoFASecret, twoFAOtpauth, onRefreshStatus, setTwoFASecret, setTwoFAOtpauth,\r\n    twoFAToken, setTwoFAToken, securityBusy, setSecurityBusy,\r\n    pwd, setPwd, pwdBusy, setPwdBusy, pwdMsg, setPwdMsg,\r\n  } = props;\r\n\r\n  const [qrDataUrl, setQrDataUrl] = useState<string | null>(null);\r\n\r\n  // Regenerate QR when otpauth changes (e.g., after setup)\r\n  useEffect(() => {\r\n    let active = true;\r\n    (async () => {\r\n      try {\r\n        if (!twoFAOtpauth) {\r\n          if (active) setQrDataUrl(null);\r\n          return;\r\n        }\r\n        const lib = await ensureQrLib();\r\n        if (lib?.toDataURL) {\r\n          const url = await lib.toDataURL(twoFAOtpauth, { margin: 1, width: 200 });\r\n          if (active) setQrDataUrl(url);\r\n        }\r\n      } catch (e) {\r\n        console.error('QR generation failed', e);\r\n      }\r\n    })();\r\n    return () => { active = false; };\r\n  }, [twoFAOtpauth]);\r\n\r\n  async function start2FA() {\r\n    setSecurityBusy(true);\r\n    try {\r\n      const r = await fetch('/api/security/2fa/setup', { method: 'POST' });\r\n      const d = await r.json();\r\n      if (d.success) {\r\n        setTwoFASecret(d.secret);\r\n        setTwoFAOtpauth(d.otpauth);\r\n        try {\r\n          const lib = await ensureQrLib();\r\n          if (lib?.toDataURL) {\r\n            const dataUrl = await lib.toDataURL(d.otpauth, { margin: 1, width: 200 });\r\n            setQrDataUrl(dataUrl);\r\n          }\r\n        } catch {}\r\n      }\r\n    } finally { setSecurityBusy(false); }\r\n  }\r\n\r\n  async function verify2FA() {\r\n    if (!twoFAToken) return;\r\n    setSecurityBusy(true);\r\n    try {\r\n      const r = await fetch('/api/security/2fa/verify', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ token: twoFAToken }) });\r\n      const d = await r.json();\r\n      if (d.success) {\r\n        setTwoFAToken('');\r\n        setTwoFASecret(null);\r\n        setTwoFAOtpauth(null);\r\n        await onRefreshStatus();\r\n      }\r\n    } finally { setSecurityBusy(false); }\r\n  }\r\n\r\n  async function disable2FA() {\r\n    setSecurityBusy(true);\r\n    try {\r\n      await fetch('/api/security/2fa/disable', { method: 'POST' });\r\n      setTwoFASecret(null);\r\n      setTwoFAOtpauth(null);\r\n      setQrDataUrl(null);\r\n      await onRefreshStatus();\r\n    } finally { setSecurityBusy(false); }\r\n  }\r\n\r\n  async function changePassword() {\r\n    setPwdMsg(null);\r\n    if (!pwd.current || !pwd.next || pwd.next !== pwd.confirm) {\r\n      setPwdMsg('Please fill all fields and ensure new passwords match.');\r\n      return;\r\n    }\r\n    setPwdBusy(true);\r\n    try {\r\n      const r = await fetch('/api/security/password', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ currentPassword: pwd.current, newPassword: pwd.next }) });\r\n      const d = await r.json();\r\n      if (r.ok && d.success) {\r\n        setPwd({ current: '', next: '', confirm: '' });\r\n        setPwdMsg('Password updated successfully.');\r\n      } else {\r\n        setPwdMsg(d.error || 'Failed to update password');\r\n      }\r\n    } finally { setPwdBusy(false); }\r\n  }\r\n\r\n  return (\r\n    <div className=\"grid md:grid-cols-2 gap-8\">\r\n      {/* 2FA */}\r\n      <div className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-3\">\r\n        <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Two‚ÄëFactor Authentication (TOTP)</h2>\r\n        <p className=\"text-xs text-gray-500 dark:text-gray-400\">Use an authenticator app (Google Authenticator, Authy). We don‚Äôt email codes for TOTP‚Äîthose are generated in your app.</p>\r\n        {twoFAEnabled === null ? (\r\n          <div className=\"text-sm text-gray-500 dark:text-gray-400\">Loading 2FA status...</div>\r\n        ) : twoFAEnabled ? (\r\n          <div className=\"space-y-3\">\r\n            <div className=\"text-sm text-green-600\">2FA is enabled for your account.</div>\r\n            <RecoveryCodesSection />\r\n            <button onClick={disable2FA} disabled={securityBusy} className=\"px-3 py-2 text-sm rounded-md bg-red-600 text-white disabled:opacity-50\">{securityBusy ? 'Working...' : 'Disable 2FA'}</button>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {!twoFASecret ? (\r\n              <button onClick={start2FA} disabled={securityBusy} className=\"px-3 py-2 text-sm rounded-md bg-blue-600 text-white disabled:opacity-50\">{securityBusy ? 'Working...' : 'Set up 2FA'}</button>\r\n            ) : (\r\n              <div className=\"space-y-2\">\r\n                <ol className=\"list-decimal pl-4 text-xs text-gray-600 dark:text-gray-400 space-y-1\">\r\n                  <li>Open your authenticator app and add an account.</li>\r\n                  <li>Scan the QR or paste the secret below.</li>\r\n                  <li>Enter the first 6‚Äëdigit code to enable.</li>\r\n                </ol>\r\n                <div className=\"text-sm text-gray-700 dark:text-gray-300\">Secret (keep private):</div>\r\n                <div className=\"p-2 rounded-md bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 font-mono text-xs break-all\">{twoFASecret}</div>\r\n                {qrDataUrl ? (\r\n                  <div className=\"flex items-center gap-4\">\r\n                    <img src={qrDataUrl} alt=\"2FA QR\" className=\"h-32 w-32 border border-gray-200 dark:border-gray-700 rounded-md bg-white p-1\" />\r\n                    <div className=\"text-[11px] text-gray-500 dark:text-gray-400 break-all\">Scan this QR in Google Authenticator, Authy, etc. If needed, use the secret above.</div>\r\n                  </div>\r\n                ) : twoFAOtpauth ? (\r\n                  <div className=\"text-[11px] text-gray-500 dark:text-gray-400 break-all\">QR is generating‚Ä¶ If it doesn‚Äôt appear, you can add using this link: {twoFAOtpauth}</div>\r\n                ) : null}\r\n                <div className=\"flex items-end gap-2 mt-2\">\r\n                  <div className=\"flex-1\">\r\n                    <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Enter 6‚Äëdigit code</label>\r\n                    <input value={twoFAToken} onChange={(e)=>setTwoFAToken(e.target.value)} maxLength={6} className=\"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm tracking-widest\" />\r\n                  </div>\r\n                  <button onClick={verify2FA} disabled={securityBusy || twoFAToken.length !== 6} className=\"px-3 py-2 text-sm rounded-md bg-green-600 text-white disabled:opacity-50\">Verify & Enable</button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Change password */}\r\n      <div className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-5 space-y-3\">\r\n        <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Change Password</h2>\r\n        {pwdMsg && <div className=\"text-xs p-2 rounded-md border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 text-gray-700 dark:text-gray-300\">{pwdMsg}</div>}\r\n        <div>\r\n          <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Current Password</label>\r\n          <input type=\"password\" value={pwd.current} onChange={(e)=>setPwd({...pwd, current: e.target.value})} className=\"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm\" />\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">New Password</label>\r\n          <input type=\"password\" value={pwd.next} onChange={(e)=>setPwd({...pwd, next: e.target.value})} className=\"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm\" />\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Confirm New Password</label>\r\n          <input type=\"password\" value={pwd.confirm} onChange={(e)=>setPwd({...pwd, confirm: e.target.value})} className=\"w-full rounded-md bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-2 text-sm\" />\r\n        </div>\r\n        <div className=\"flex justify-end\">\r\n          <button onClick={changePassword} disabled={pwdBusy} className=\"px-3 py-2 text-sm rounded-md bg-blue-600 text-white disabled:opacity-50\">{pwdBusy ? 'Updating...' : 'Update Password'}</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction RecoveryCodesSection() {\r\n  const [busy, setBusy] = useState(false);\r\n  const [codes, setCodes] = useState<string[] | null>(null);\r\n  const [msg, setMsg] = useState<string | null>(null);\r\n\r\n  async function generate() {\r\n    setBusy(true); setMsg(null);\r\n    try {\r\n      const r = await fetch('/api/security/2fa/recovery/generate', { method: 'POST' });\r\n      const d = await r.json();\r\n      if (r.ok && d.success && Array.isArray(d.codes)) {\r\n        setCodes(d.codes);\r\n      } else {\r\n        setMsg(d.error || 'Failed to generate codes');\r\n      }\r\n    } finally { setBusy(false); }\r\n  }\r\n\r\n  return (\r\n    <div className=\"border-t border-gray-200 dark:border-gray-700 pt-3 mt-2\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <div className=\"text-sm font-medium text-gray-900 dark:text-white\">Recovery Codes</div>\r\n          <div className=\"text-xs text-gray-500 dark:text-gray-400\">Use when you lose access to your authenticator. Each code can be used once.</div>\r\n        </div>\r\n        <button onClick={generate} disabled={busy} className=\"px-3 py-2 text-sm rounded-md bg-indigo-600 text-white disabled:opacity-50\">{busy ? 'Working...' : 'Generate new'}</button>\r\n      </div>\r\n      {msg && <div className=\"mt-2 text-xs text-red-500\">{msg}</div>}\r\n      {codes && (\r\n        <div className=\"mt-3 p-3 rounded-md bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700\">\r\n          <div className=\"text-xs text-amber-600 mb-2\">Save these now. They won‚Äôt be shown again.</div>\r\n          <div className=\"grid grid-cols-2 gap-2 font-mono text-sm\">\r\n            {codes.map((c, i) => <div key={i} className=\"px-2 py-1 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700\">{c}</div>)}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}