{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/FullStackDev/fintrackrx/app/login/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useAuth } from \"@/components/AuthProvider\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default function LoginPage() {\r\n  const { login, completeTotp, startEmailOtp, completeEmailOtp, completeRecovery } = useAuth();\r\n  const router = useRouter();\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [mfaToken, setMfaToken] = useState<string | null>(null);\r\n  const [totp, setTotp] = useState(\"\");\r\n  const [emailCode, setEmailCode] = useState(\"\");\r\n  const [recoveryCode, setRecoveryCode] = useState(\"\");\r\n  const [mfaMethod, setMfaMethod] = useState<'totp' | 'email' | 'recovery'>('totp');\r\n  const [emailSent, setEmailSent] = useState(false);\r\n\r\n  async function onSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setError(null);\r\n    setLoading(true);\r\n    const res = await login(email, password);\r\n    setLoading(false);\r\n    if (res === true) {\r\n      router.push(\"/dashboard\");\r\n      return;\r\n    }\r\n    if (res && (res as any).mfa_required) {\r\n      setMfaToken((res as any).mfa_token);\r\n      return;\r\n    }\r\n    setError(\"Invalid credentials. Try signing up if you don't have an account.\");\r\n  }\r\n\r\n  async function onSubmitMfa(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    if (!mfaToken) return;\r\n    setError(null);\r\n    setLoading(true);\r\n    let ok = false;\r\n    if (mfaMethod === 'totp') {\r\n      ok = await completeTotp(mfaToken, totp);\r\n      if (!ok) setError('Invalid authenticator code.');\r\n    } else if (mfaMethod === 'email') {\r\n      ok = await completeEmailOtp(mfaToken, emailCode);\r\n      if (!ok) setError('Invalid email code.');\r\n    } else if (mfaMethod === 'recovery') {\r\n      ok = await completeRecovery(mfaToken, recoveryCode.trim());\r\n      if (!ok) setError('Invalid recovery code.');\r\n    }\r\n    setLoading(false);\r\n    if (ok) router.push('/dashboard');\r\n  }\r\n\r\n  async function onSendEmailCode() {\r\n    if (!mfaToken) return;\r\n    setError(null);\r\n    setLoading(true);\r\n    const ok = await startEmailOtp(mfaToken);\r\n    setLoading(false);\r\n    if (ok) {\r\n      setEmailSent(true);\r\n    } else {\r\n      setError('Could not send email code. Try again later.');\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-[70vh] flex items-center justify-center px-4 bg-black\">\r\n      <div className=\"w-full max-w-md bg-gray-900 rounded-xl border border-gray-800 p-8\">\r\n        <div className=\"text-center mb-8\">\r\n          <div className=\"inline-flex w-16 h-16 bg-gray-800 rounded-xl items-center justify-center mb-4\">\r\n            <span className=\"text-3xl\">üîê</span>\r\n          </div>\r\n          <h1 className=\"text-2xl font-bold text-white\">Welcome back</h1>\r\n          <p className=\"text-sm text-gray-400 mt-2\">Sign in to your account</p>\r\n        </div>\r\n  {!mfaToken ? (\r\n  <form onSubmit={onSubmit} className=\"space-y-4\">\r\n          <label className=\"block\">\r\n            <span className=\"text-sm font-medium text-gray-300\">Email</span>\r\n            <input\r\n              type=\"email\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              required\r\n              className=\"mt-1 block w-full rounded-lg border border-gray-700 bg-gray-800 text-white px-4 py-2.5 focus:ring-2 focus:ring-gray-600 focus:border-transparent placeholder-gray-400\"\r\n            />\r\n          </label>\r\n\r\n          <label className=\"block\">\r\n            <span className=\"text-sm font-medium text-gray-300\">Password</span>\r\n            <input\r\n              type=\"password\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n              required\r\n              className=\"mt-1 block w-full rounded-lg border border-gray-700 bg-gray-800 text-white px-4 py-2.5 focus:ring-2 focus:ring-gray-600 focus:border-transparent placeholder-gray-400\"\r\n            />\r\n          </label>\r\n\r\n          {error && <div className=\"text-sm text-gray-300 bg-gray-800 p-3 rounded-lg border border-gray-700\">‚ö†Ô∏è {error}</div>}\r\n\r\n          <button\r\n            type=\"submit\"\r\n            className=\"w-full px-4 py-3 rounded-lg bg-gray-100 text-gray-900 font-medium hover:bg-gray-200 transition-colors disabled:opacity-50\"\r\n            disabled={loading}\r\n          >\r\n            {loading ? \"‚è≥ Signing in...\" : \"Sign in\"}\r\n          </button>\r\n\r\n          <div className=\"text-center text-sm text-gray-400\">\r\n            Don't have an account?{\" \"}\r\n            <a href=\"/signup\" className=\"text-white font-medium hover:underline\">\r\n              Create account\r\n            </a>\r\n            <span className=\"mx-2 text-gray-600\">‚Ä¢</span>\r\n            <a href=\"/auth/forgot-password\" className=\"text-gray-300 hover:text-white underline underline-offset-2\">\r\n              Forgot password?\r\n            </a>\r\n          </div>\r\n        </form>\r\n        ) : (\r\n        <form onSubmit={onSubmitMfa} className=\"space-y-5\">\r\n          <div className=\"text-sm text-gray-300 space-y-2\">\r\n            <div>Two‚Äëfactor authentication required. Choose a method:</div>\r\n            <div className=\"flex gap-2 text-xs\">\r\n              {['totp','email','recovery'].map(m => (\r\n                <button type=\"button\" key={m} onClick={()=>setMfaMethod(m as any)} className={`px-3 py-1.5 rounded-md border ${mfaMethod===m?'bg-gray-100 text-gray-900 border-gray-300':'bg-gray-800 text-gray-300 border-gray-700'}`}>{m==='totp'?'Authenticator': m==='email'?'Email Code':'Recovery Code'}</button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n          {mfaMethod === 'totp' && (\r\n            <label className=\"block\">\r\n              <span className=\"text-sm font-medium text-gray-300\">6‚Äëdigit authenticator code</span>\r\n              <input\r\n                type=\"text\"\r\n                value={totp}\r\n                onChange={(e) => setTotp(e.target.value)}\r\n                required\r\n                maxLength={6}\r\n                className=\"mt-1 tracking-widest text-center block w-full rounded-lg border border-gray-700 bg-gray-800 text-white px-4 py-2.5 focus:ring-2 focus:ring-gray-600 focus:border-transparent placeholder-gray-400\"\r\n              />\r\n              <p className=\"mt-2 text-xs text-gray-400\">Open Google Authenticator / Authy ‚Äì the code refreshes every 30s.</p>\r\n            </label>\r\n          )}\r\n          {mfaMethod === 'email' && (\r\n            <div className=\"space-y-3\">\r\n              {!emailSent && (\r\n                <button type=\"button\" onClick={onSendEmailCode} disabled={loading} className=\"w-full px-4 py-2.5 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white text-sm disabled:opacity-50\">{loading? 'Sending...' : 'Send email code'}</button>\r\n              )}\r\n              {emailSent && (\r\n                <label className=\"block\">\r\n                  <span className=\"text-sm font-medium text-gray-300\">Enter code sent to your email</span>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={emailCode}\r\n                    onChange={(e)=>setEmailCode(e.target.value)}\r\n                    required\r\n                    maxLength={6}\r\n                    className=\"mt-1 tracking-widest text-center block w-full rounded-lg border border-gray-700 bg-gray-800 text-white px-4 py-2.5 focus:ring-2 focus:ring-gray-600 focus:border-transparent placeholder-gray-400\"\r\n                  />\r\n                  <p className=\"mt-2 text-xs text-gray-400\">Check your inbox (and spam). Code expires in 10 minutes.</p>\r\n                </label>\r\n              )}\r\n            </div>\r\n          )}\r\n          {mfaMethod === 'recovery' && (\r\n            <label className=\"block\">\r\n              <span className=\"text-sm font-medium text-gray-300\">Recovery code</span>\r\n              <input\r\n                type=\"text\"\r\n                value={recoveryCode}\r\n                onChange={(e)=>setRecoveryCode(e.target.value)}\r\n                required\r\n                className=\"mt-1 block w-full rounded-lg border border-gray-700 bg-gray-800 text-white px-4 py-2.5 focus:ring-2 focus:ring-gray-600 focus:border-transparent placeholder-gray-400\"\r\n              />\r\n              <p className=\"mt-2 text-xs text-amber-400\">Single‚Äëuse. After login, generate new codes in Settings.</p>\r\n            </label>\r\n          )}\r\n\r\n          {error && <div className=\"text-sm text-gray-300 bg-gray-800 p-3 rounded-lg border border-gray-700\">‚ö†Ô∏è {error}</div>}\r\n\r\n          <button\r\n            type=\"submit\"\r\n            className=\"w-full px-4 py-3 rounded-lg bg-gray-100 text-gray-900 font-medium hover:bg-gray-200 transition-colors disabled:opacity-50\"\r\n            disabled={loading || (mfaMethod==='email' && emailSent && emailCode.length<6) || (mfaMethod==='totp' && totp.length<6) || (mfaMethod==='recovery' && recoveryCode.length<6)}\r\n          >\r\n            {loading ? '‚è≥ Verifying...' : 'Verify & Sign in'}\r\n          </button>\r\n          <div className=\"text-center text-xs text-gray-500 space-y-1\">\r\n            <div>Need authenticator? Set up under Settings ‚Üí Two‚ÄëFactor Authentication.</div>\r\n            <div><a href=\"/auth/forgot-password\" className=\"text-gray-300 hover:text-white underline underline-offset-2\">Forgot password?</a></div>\r\n          </div>\r\n        </form>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}