{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/FullStackDev/fintrackrx/lib/finnhub.ts"],"sourcesContent":["// Finnhub API integration for stock market data\r\nconst FINNHUB_API_KEY = process.env.FINNHUB_API_KEY || 'd487ge1r01qk80bjptfgd487ge1r01qk80bjptg0';\r\nconst FINNHUB_BASE_URL = 'https://finnhub.io/api/v1';\r\n\r\n// Get stock quote (current price, change, etc.)\r\nexport async function getQuote(symbol: string) {\r\n  try {\r\n    const response = await fetch(\r\n      `${FINNHUB_BASE_URL}/quote?symbol=${symbol}&token=${FINNHUB_API_KEY}`\r\n    );\r\n    const data = await response.json();\r\n    \r\n    return {\r\n      currentPrice: data.c, // Current price\r\n      change: data.d, // Change\r\n      percentChange: data.dp, // Percent change\r\n      high: data.h, // High price of the day\r\n      low: data.l, // Low price of the day\r\n      open: data.o, // Open price of the day\r\n      previousClose: data.pc, // Previous close price\r\n      timestamp: data.t, // Timestamp\r\n    };\r\n  } catch (error) {\r\n    console.error('Finnhub quote error:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// Get company profile\r\nexport async function getCompanyProfile(symbol: string) {\r\n  try {\r\n    const response = await fetch(\r\n      `${FINNHUB_BASE_URL}/stock/profile2?symbol=${symbol}&token=${FINNHUB_API_KEY}`\r\n    );\r\n    const data = await response.json();\r\n    \r\n    return {\r\n      name: data.name,\r\n      ticker: data.ticker,\r\n      exchange: data.exchange,\r\n      currency: data.currency,\r\n      country: data.country,\r\n      industry: data.finnhubIndustry,\r\n      logo: data.logo,\r\n      marketCap: data.marketCapitalization,\r\n    };\r\n  } catch (error) {\r\n    console.error('Finnhub profile error:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// Search for stocks\r\nexport async function searchSymbol(query: string) {\r\n  try {\r\n    const url = `${FINNHUB_BASE_URL}/search?q=${query}&token=${FINNHUB_API_KEY}`;\r\n    console.log('üåê Fetching from Finnhub:', url);\r\n    \r\n    const response = await fetch(url);\r\n    const data = await response.json();\r\n    \r\n    console.log('üì° Raw Finnhub API response:', data);\r\n    \r\n    // Check if data.result exists and is an array\r\n    if (!data.result || !Array.isArray(data.result)) {\r\n      console.warn('‚ö†Ô∏è Unexpected Finnhub response structure:', data);\r\n      return [];\r\n    }\r\n    \r\n    const mapped = data.result.map((item: any) => ({\r\n      symbol: item.symbol,\r\n      description: item.description,\r\n      type: item.type,\r\n      displaySymbol: item.displaySymbol,\r\n    }));\r\n    \r\n    console.log('üîß Mapped results:', mapped);\r\n    return mapped;\r\n  } catch (error) {\r\n    console.error('‚ùå Finnhub search error:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n// Get historical candles (for charts)\r\nexport async function getCandles(symbol: string, resolution: string = 'D', from: number, to: number) {\r\n  try {\r\n    const response = await fetch(\r\n      `${FINNHUB_BASE_URL}/stock/candle?symbol=${symbol}&resolution=${resolution}&from=${from}&to=${to}&token=${FINNHUB_API_KEY}`\r\n    );\r\n    const data = await response.json();\r\n    \r\n    if (data.s !== 'ok') return null;\r\n    \r\n    return {\r\n      timestamps: data.t,\r\n      open: data.o,\r\n      high: data.h,\r\n      low: data.l,\r\n      close: data.c,\r\n      volume: data.v,\r\n    };\r\n  } catch (error) {\r\n    console.error('Finnhub candles error:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// Get market news\r\nexport async function getMarketNews(category: string = 'general') {\r\n  try {\r\n    const response = await fetch(\r\n      `${FINNHUB_BASE_URL}/news?category=${category}&token=${FINNHUB_API_KEY}`\r\n    );\r\n    const data = await response.json();\r\n    \r\n    return data.slice(0, 10).map((item: any) => ({\r\n      headline: item.headline,\r\n      summary: item.summary,\r\n      source: item.source,\r\n      url: item.url,\r\n      image: item.image,\r\n      datetime: item.datetime,\r\n    }));\r\n  } catch (error) {\r\n    console.error('Finnhub news error:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n// Get company news\r\nexport async function getCompanyNews(symbol: string, from: string, to: string) {\r\n  try {\r\n    const response = await fetch(\r\n      `${FINNHUB_BASE_URL}/company-news?symbol=${symbol}&from=${from}&to=${to}&token=${FINNHUB_API_KEY}`\r\n    );\r\n    const data = await response.json();\r\n    \r\n    return data.slice(0, 10).map((item: any) => ({\r\n      headline: item.headline,\r\n      summary: item.summary,\r\n      source: item.source,\r\n      url: item.url,\r\n      image: item.image,\r\n      datetime: item.datetime,\r\n    }));\r\n  } catch (error) {\r\n    console.error('Finnhub company news error:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n// Batch update prices for multiple symbols\r\nexport async function batchUpdatePrices(symbols: string[]): Promise<{ [symbol: string]: number }> {\r\n  const quotes = await Promise.all(\r\n    symbols.map(async (symbol) => {\r\n      const quote = await getQuote(symbol);\r\n      return { symbol, price: quote?.currentPrice || 0 };\r\n    })\r\n  );\r\n  \r\n  const priceMap: { [symbol: string]: number } = {};\r\n  quotes.forEach(({ symbol, price }) => {\r\n    priceMap[symbol] = price;\r\n  });\r\n  \r\n  return priceMap;\r\n}\r\n\r\nexport const finnhubService = {\r\n  getQuote,\r\n  getCompanyProfile,\r\n  searchSymbol,\r\n  getCandles,\r\n  getMarketNews,\r\n  getCompanyNews,\r\n  batchUpdatePrices,\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 209, "column": 0}, "map": {"version":3,"sources":["file:///D:/FullStackDev/fintrackrx/app/api/stocks/search/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { searchSymbol } from '@/lib/finnhub';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const query = searchParams.get('q');\r\n\r\n    console.log('üîç Stock search API called with query:', query);\r\n\r\n    if (!query || query.length < 1) {\r\n      console.log('‚ùå Query too short or empty');\r\n      return NextResponse.json({ results: [] });\r\n    }\r\n\r\n    console.log('üì° Calling searchSymbol...');\r\n    const results = await searchSymbol(query);\r\n    console.log('üì¶ Raw Finnhub results count:', results?.length || 0);\r\n    console.log('üì¶ First few results:', results?.slice(0, 3));\r\n    \r\n    // Temporarily show ALL results to see what types Finnhub returns\r\n    const filteredResults = results.slice(0, 10); // Just limit count, no type filtering\r\n    \r\n    console.log('‚úÖ All result types found:');\r\n    results.forEach((result: any, index: number) => {\r\n      console.log(`  ${index + 1}. ${result.symbol} - ${result.description} (TYPE: \"${result.type}\")`);\r\n    });\r\n\r\n    console.log('‚úÖ Filtered results count:', filteredResults.length);\r\n    console.log('‚úÖ Final results:', filteredResults);\r\n    \r\n    return NextResponse.json({ results: filteredResults });\r\n  } catch (error) {\r\n    console.error('‚ùå Stock search error:', error);\r\n    return NextResponse.json({ error: 'Failed to search stocks' }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,aAAa,GAAG,CAAC;QAE/B,QAAQ,GAAG,CAAC,0CAA0C;QAEtD,IAAI,CAAC,SAAS,MAAM,MAAM,GAAG,GAAG;YAC9B,QAAQ,GAAG,CAAC;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS,EAAE;YAAC;QACzC;QAEA,QAAQ,GAAG,CAAC;QACZ,MAAM,UAAU,MAAM,IAAA,gIAAY,EAAC;QACnC,QAAQ,GAAG,CAAC,iCAAiC,SAAS,UAAU;QAChE,QAAQ,GAAG,CAAC,yBAAyB,SAAS,MAAM,GAAG;QAEvD,iEAAiE;QACjE,MAAM,kBAAkB,QAAQ,KAAK,CAAC,GAAG,KAAK,sCAAsC;QAEpF,QAAQ,GAAG,CAAC;QACZ,QAAQ,OAAO,CAAC,CAAC,QAAa;YAC5B,QAAQ,GAAG,CAAC,CAAC,EAAE,EAAE,QAAQ,EAAE,EAAE,EAAE,OAAO,MAAM,CAAC,GAAG,EAAE,OAAO,WAAW,CAAC,SAAS,EAAE,OAAO,IAAI,CAAC,EAAE,CAAC;QACjG;QAEA,QAAQ,GAAG,CAAC,6BAA6B,gBAAgB,MAAM;QAC/D,QAAQ,GAAG,CAAC,oBAAoB;QAEhC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAgB;IACtD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACF","debugId":null}}]
}