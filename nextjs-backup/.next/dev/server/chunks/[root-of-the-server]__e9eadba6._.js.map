{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/FullStackDev/fintrackrx/app/api/ai/advisor/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\n\r\nconst HUGGINGFACE_API_URL = 'https://api-inference.huggingface.co/models/HuggingFaceTB/SmolLM3-3B';\r\nconst HUGGINGFACE_TOKEN = process.env.HUGGINGFACE_TOKEN;\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { question, financialData } = await request.json();\r\n\r\n    if (!question) {\r\n      return NextResponse.json({ error: 'Question is required' }, { status: 400 });\r\n    }\r\n\r\n    if (!HUGGINGFACE_TOKEN) {\r\n      return NextResponse.json({ error: 'Hugging Face token not configured' }, { status: 500 });\r\n    }\r\n\r\n    // Create a detailed prompt with financial context\r\n    const prompt = `You are a helpful financial advisor for Indian households. Answer the following question based on the user's financial data.\r\n\r\nUser's Financial Data:\r\n- Monthly Income: ₹${financialData.monthlyIncome?.toLocaleString() || 0}\r\n- Monthly Expenses: ₹${financialData.monthlyExpenses?.toLocaleString() || 0}\r\n- Current Balance: ₹${financialData.balance?.toLocaleString() || 0}\r\n- Savings Rate: ${financialData.savingsRate?.toFixed(1) || 0}%\r\n- Number of Transactions: ${financialData.transactionCount || 0}\r\n\r\nQuestion: ${question}\r\n\r\nProvide a clear, concise, and actionable answer in 2-3 sentences. Focus on practical Indian financial advice.\r\n\r\nAnswer:`;\r\n\r\n    // Call Hugging Face API\r\n    const response = await fetch(HUGGINGFACE_API_URL, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${HUGGINGFACE_TOKEN}`,\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        inputs: prompt,\r\n        parameters: {\r\n          max_new_tokens: 150,\r\n          temperature: 0.7,\r\n          top_p: 0.9,\r\n          do_sample: true,\r\n          return_full_text: false,\r\n        },\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text();\r\n      console.error('Hugging Face API error:', error);\r\n      \r\n      // Fallback to rule-based response if API fails\r\n      return NextResponse.json({ \r\n        answer: getFallbackAnswer(question, financialData),\r\n        source: 'fallback' \r\n      });\r\n    }\r\n\r\n    const result = await response.json();\r\n    \r\n    // Extract the generated text\r\n    let answer = '';\r\n    if (Array.isArray(result) && result.length > 0) {\r\n      answer = result[0].generated_text?.trim() || '';\r\n    } else if (result.generated_text) {\r\n      answer = result.generated_text.trim();\r\n    }\r\n\r\n    // If answer is empty or too short, use fallback\r\n    if (!answer || answer.length < 20) {\r\n      return NextResponse.json({ \r\n        answer: getFallbackAnswer(question, financialData),\r\n        source: 'fallback' \r\n      });\r\n    }\r\n\r\n    return NextResponse.json({ answer, source: 'ai' });\r\n\r\n  } catch (error) {\r\n    console.error('AI advisor error:', error);\r\n    \r\n    // Return fallback response on error\r\n    const { question, financialData } = await request.json();\r\n    return NextResponse.json({ \r\n      answer: getFallbackAnswer(question, financialData),\r\n      source: 'fallback' \r\n    });\r\n  }\r\n}\r\n\r\n// Fallback rule-based responses\r\nfunction getFallbackAnswer(question: string, financialData: any): string {\r\n  const q = question.toLowerCase();\r\n  const { monthlyIncome = 0, monthlyExpenses = 0, savingsRate = 0 } = financialData;\r\n  const savings = monthlyIncome - monthlyExpenses;\r\n\r\n  if (q.includes('sav') || q.includes('save')) {\r\n    return `Based on your current spending, you can save approximately ₹${Math.max(0, savings).toLocaleString()} per month. Consider automating transfers to a savings account and aim for a 20-30% savings rate for financial security.`;\r\n  }\r\n  \r\n  if (q.includes('invest') || q.includes('investment') || q.includes('sip')) {\r\n    return `For Indian households, start with a SIP in diversified mutual funds. With your monthly savings of ₹${Math.max(0, savings).toLocaleString()}, consider investing 50-60% in equity funds and 40-50% in debt funds for balanced growth.`;\r\n  }\r\n  \r\n  if (q.includes('budget') || q.includes('expense')) {\r\n    const expenseRatio = monthlyIncome > 0 ? (monthlyExpenses / monthlyIncome) * 100 : 0;\r\n    return `Your monthly expenses are ₹${monthlyExpenses.toLocaleString()}, which is ${expenseRatio.toFixed(1)}% of your income. Try to keep expenses below 70% of income. Focus on reducing discretionary spending and track all expenses regularly.`;\r\n  }\r\n  \r\n  if (q.includes('emergency') || q.includes('fund')) {\r\n    const emergencyFund = monthlyExpenses * 6;\r\n    return `Your emergency fund should cover 6 months of expenses, which is ₹${emergencyFund.toLocaleString()}. Start by saving 10-15% of your income each month in a liquid fund or high-yield savings account.`;\r\n  }\r\n  \r\n  if (q.includes('tax') || q.includes('80c')) {\r\n    return `To save tax under Section 80C, invest up to ₹1.5 lakh annually in ELSS, PPF, or NPS. Additionally, consider health insurance (80D) and home loan interest (24b) for more deductions. Plan your tax-saving investments before March each year.`;\r\n  }\r\n  \r\n  if (q.includes('debt') || q.includes('loan') || q.includes('credit card')) {\r\n    return `Prioritize clearing high-interest debts like credit cards (18-40% APR) first. Use the avalanche method: pay minimums on all debts, then extra on the highest interest rate. Avoid taking new loans until existing debts are under control.`;\r\n  }\r\n\r\n  // Default response\r\n  return `Based on your financial data: You have a savings rate of ${savingsRate.toFixed(1)}%. Your monthly income is ₹${monthlyIncome.toLocaleString()} and expenses are ₹${monthlyExpenses.toLocaleString()}. Focus on maintaining a savings rate above 20% and building an emergency fund of 6 months' expenses for long-term financial security.`;\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}